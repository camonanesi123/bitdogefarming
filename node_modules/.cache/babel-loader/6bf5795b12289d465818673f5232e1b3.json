{"ast":null,"code":"import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"D:/task159/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/task159/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/task159/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"D:/task159/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{createContext,useEffect,useMemo,useReducer}from'react';import BigNumber from'bignumber.js';import{getBunnyFactoryContract}from'utils/contractHelpers';import{useWallet}from'@binance-chain/bsc-use-wallet';import{MINT_COST,REGISTER_COST,ALLOWANCE_MULTIPLIER}from'../config';var totalCost=MINT_COST+REGISTER_COST;var allowance=totalCost*ALLOWANCE_MULTIPLIER;var initialState={isInitialized:false,currentStep:0,teamId:null,selectedNft:{nftAddress:null,tokenId:null},userName:'',minimumCakeRequired:new BigNumber(totalCost).multipliedBy(new BigNumber(10).pow(18)),allowance:new BigNumber(allowance).multipliedBy(new BigNumber(10).pow(18))};var reducer=function reducer(state,action){switch(action.type){case'initialize':return _objectSpread(_objectSpread({},state),{},{isInitialized:true,currentStep:action.step});case'next_step':return _objectSpread(_objectSpread({},state),{},{currentStep:state.currentStep+1});case'set_team':return _objectSpread(_objectSpread({},state),{},{teamId:action.teamId});case'set_selected_nft':return _objectSpread(_objectSpread({},state),{},{selectedNft:{tokenId:action.tokenId,nftAddress:action.nftAddress}});case'set_username':return _objectSpread(_objectSpread({},state),{},{userName:action.userName});default:return state;}};export var ProfileCreationContext=/*#__PURE__*/createContext(null);var ProfileCreationProvider=function ProfileCreationProvider(_ref){var children=_ref.children;var _useReducer=useReducer(reducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var _useWallet=useWallet(),account=_useWallet.account;// Initial checks\nuseEffect(function(){var isSubscribed=true;var fetchData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var bunnyFactoryContract,canMint;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:bunnyFactoryContract=getBunnyFactoryContract();_context.next=3;return bunnyFactoryContract.methods.canMint(account).call();case 3:canMint=_context.sent;dispatch({type:'initialize',step:canMint?0:1});// When changing wallets quickly unmounting before the hasClaim finished causes a React error\nif(isSubscribed){dispatch({type:'initialize',step:canMint?0:1});}case 6:case\"end\":return _context.stop();}}},_callee);}));return function fetchData(){return _ref2.apply(this,arguments);};}();if(account){fetchData();}return function(){isSubscribed=false;};},[account,dispatch]);var actions=useMemo(function(){return{nextStep:function nextStep(){return dispatch({type:'next_step'});},setTeamId:function setTeamId(teamId){return dispatch({type:'set_team',teamId:teamId});},setSelectedNft:function setSelectedNft(tokenId,nftAddress){return dispatch({type:'set_selected_nft',tokenId:tokenId,nftAddress:nftAddress});},setUserName:function setUserName(userName){return dispatch({type:'set_username',userName:userName});}};},[dispatch]);return/*#__PURE__*/_jsx(ProfileCreationContext.Provider,{value:_objectSpread(_objectSpread({},state),{},{actions:actions}),children:children});};export default ProfileCreationProvider;","map":{"version":3,"sources":["D:/task159/frontend/src/views/Profile/ProfileCreation/contexts/ProfileCreationProvider.tsx"],"names":["React","createContext","useEffect","useMemo","useReducer","BigNumber","getBunnyFactoryContract","useWallet","MINT_COST","REGISTER_COST","ALLOWANCE_MULTIPLIER","totalCost","allowance","initialState","isInitialized","currentStep","teamId","selectedNft","nftAddress","tokenId","userName","minimumCakeRequired","multipliedBy","pow","reducer","state","action","type","step","ProfileCreationContext","ProfileCreationProvider","children","dispatch","account","isSubscribed","fetchData","bunnyFactoryContract","methods","canMint","call","actions","nextStep","setTeamId","setSelectedNft","setUserName"],"mappings":"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","sourcesContent":["import React, { createContext, useEffect, useMemo, useReducer } from 'react'\nimport BigNumber from 'bignumber.js'\nimport { useWeb3React } from '@web3-react/core'\nimport { getBunnyFactoryContract } from 'utils/contractHelpers'\nimport { useWallet } from '@binance-chain/bsc-use-wallet'\nimport { MINT_COST, REGISTER_COST, ALLOWANCE_MULTIPLIER } from '../config'\nimport { Actions, State, ContextType } from './types'\n\nconst totalCost = MINT_COST + REGISTER_COST\nconst allowance = totalCost * ALLOWANCE_MULTIPLIER\n\nconst initialState: State = {\n  isInitialized: false,\n  currentStep: 0,\n  teamId: null,\n  selectedNft: {\n    nftAddress: null,\n    tokenId: null,\n  },\n  userName: '',\n  minimumCakeRequired: new BigNumber(totalCost).multipliedBy(new BigNumber(10).pow(18)),\n  allowance: new BigNumber(allowance).multipliedBy(new BigNumber(10).pow(18)),\n}\n\nconst reducer = (state: State, action: Actions): State => {\n  switch (action.type) {\n    case 'initialize':\n      return {\n        ...state,\n        isInitialized: true,\n        currentStep: action.step,\n      }\n    case 'next_step':\n      return {\n        ...state,\n        currentStep: state.currentStep + 1,\n      }\n    case 'set_team':\n      return {\n        ...state,\n        teamId: action.teamId,\n      }\n    case 'set_selected_nft':\n      return {\n        ...state,\n        selectedNft: {\n          tokenId: action.tokenId,\n          nftAddress: action.nftAddress,\n        },\n      }\n    case 'set_username':\n      return {\n        ...state,\n        userName: action.userName,\n      }\n    default:\n      return state\n  }\n}\n\nexport const ProfileCreationContext = createContext<ContextType>(null)\n\nconst ProfileCreationProvider: React.FC = ({ children }) => {\n  const [state, dispatch] = useReducer(reducer, initialState)\n  const { account } = useWallet()\n  // Initial checks\n  useEffect(() => {\n    let isSubscribed = true\n\n    const fetchData = async () => {\n      const bunnyFactoryContract = getBunnyFactoryContract()\n      const canMint = await bunnyFactoryContract.methods.canMint(account).call()\n      dispatch({ type: 'initialize', step: canMint ? 0 : 1 })\n\n      // When changing wallets quickly unmounting before the hasClaim finished causes a React error\n      if (isSubscribed) {\n        dispatch({ type: 'initialize', step: canMint ? 0 : 1 })\n      }\n    }\n\n    if (account) {\n      fetchData()\n    }\n\n    return () => {\n      isSubscribed = false\n    }\n  }, [account, dispatch])\n\n  const actions: ContextType['actions'] = useMemo(\n    () => ({\n      nextStep: () => dispatch({ type: 'next_step' }),\n      setTeamId: (teamId: number) => dispatch({ type: 'set_team', teamId }),\n      setSelectedNft: (tokenId: number, nftAddress: string) =>\n        dispatch({ type: 'set_selected_nft', tokenId, nftAddress }),\n      setUserName: (userName: string) => dispatch({ type: 'set_username', userName }),\n    }),\n    [dispatch],\n  )\n\n  return <ProfileCreationContext.Provider value={{ ...state, actions }}>{children}</ProfileCreationContext.Provider>\n}\n\nexport default ProfileCreationProvider\n"]},"metadata":{},"sourceType":"module"}