{"ast":null,"code":"import _regeneratorRuntime from\"D:/task159/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"D:/task159/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"D:/task159/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _asyncToGenerator from\"D:/task159/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import BigNumber from'bignumber.js';import erc20 from'config/abi/erc20.json';import masterchef3ABI from'config/abi/masterchef3.json';import multicall from'utils/multicall';import{getMasterChef3Address}from'utils/addressHelpers';import farms3Config from'config/constants/farms3';import{QuoteToken}from'../../config/constants/types';var CHAIN_ID=process.env.REACT_APP_CHAIN_ID;var fetchFarms3=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return Promise.all(farms3Config.map(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(farm3Config){var lpAdress,calls,_yield$multicall,_yield$multicall2,tokenBalanceLP,quoteTokenBlanceLP,lpTokenBalanceMC,lpTotalSupply,tokenDecimals,quoteTokenDecimals,tokenAmount,lpTotalInQuoteToken,tokenPriceVsQuote,lpTokenRatio,quoteTokenAmount,_yield$multicall3,_yield$multicall4,info,totalAllocPoint,senzuPerBlock,allocPoint,poolWeight;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:lpAdress=farm3Config.lpAddresses[CHAIN_ID];calls=[// Balance of token in the LP contract\n{address:farm3Config.tokenAddresses[CHAIN_ID],name:'balanceOf',params:[lpAdress]},// Balance of quote token on LP contract\n{address:farm3Config.quoteTokenAdresses[CHAIN_ID],name:'balanceOf',params:[lpAdress]},// Balance of LP tokens in the master chef contract\n{address:farm3Config.isTokenOnly?farm3Config.tokenAddresses[CHAIN_ID]:lpAdress,name:'balanceOf',params:[getMasterChef3Address()]},// Total supply of LP tokens\n{address:lpAdress,name:'totalSupply'},// Token decimals\n{address:farm3Config.tokenAddresses[CHAIN_ID],name:'decimals'},// Quote token decimals\n{address:farm3Config.quoteTokenAdresses[CHAIN_ID],name:'decimals'}];_context.next=4;return multicall(erc20,calls);case 4:_yield$multicall=_context.sent;_yield$multicall2=_slicedToArray(_yield$multicall,6);tokenBalanceLP=_yield$multicall2[0];quoteTokenBlanceLP=_yield$multicall2[1];lpTokenBalanceMC=_yield$multicall2[2];lpTotalSupply=_yield$multicall2[3];tokenDecimals=_yield$multicall2[4];quoteTokenDecimals=_yield$multicall2[5];if(farm3Config.isTokenOnly){tokenAmount=new BigNumber(lpTokenBalanceMC).div(new BigNumber(10).pow(tokenDecimals));if(farm3Config.tokenSymbol===QuoteToken.BUSD&&farm3Config.quoteTokenSymbol===QuoteToken.BUSD){tokenPriceVsQuote=new BigNumber(1);}else{tokenPriceVsQuote=new BigNumber(quoteTokenBlanceLP).div(new BigNumber(tokenBalanceLP));}lpTotalInQuoteToken=tokenAmount.times(tokenPriceVsQuote);}else{// Ratio in % a LP tokens that are in staking, vs the total number in circulation\nlpTokenRatio=new BigNumber(lpTokenBalanceMC).div(new BigNumber(lpTotalSupply));// Total value in staking in quote token value\nlpTotalInQuoteToken=new BigNumber(quoteTokenBlanceLP).div(new BigNumber(10).pow(18)).times(new BigNumber(2)).times(lpTokenRatio);// Amount of token in the LP that are considered staking (i.e amount of token * lp ratio)\ntokenAmount=new BigNumber(tokenBalanceLP).div(new BigNumber(10).pow(tokenDecimals)).times(lpTokenRatio);quoteTokenAmount=new BigNumber(quoteTokenBlanceLP).div(new BigNumber(10).pow(quoteTokenDecimals)).times(lpTokenRatio);if(tokenAmount.comparedTo(0)>0){tokenPriceVsQuote=quoteTokenAmount.div(tokenAmount);}else{tokenPriceVsQuote=new BigNumber(quoteTokenBlanceLP).div(new BigNumber(tokenBalanceLP));}}_context.next=15;return multicall(masterchef3ABI,[{address:getMasterChef3Address(),name:'poolInfo',params:[farm3Config.pid]},{address:getMasterChef3Address(),name:'totalAllocPoint'},{address:getMasterChef3Address(),name:'senzuPerBlock'}]);case 15:_yield$multicall3=_context.sent;_yield$multicall4=_slicedToArray(_yield$multicall3,3);info=_yield$multicall4[0];totalAllocPoint=_yield$multicall4[1];senzuPerBlock=_yield$multicall4[2];allocPoint=new BigNumber(info.allocPoint._hex);poolWeight=allocPoint.div(new BigNumber(totalAllocPoint));return _context.abrupt(\"return\",_objectSpread(_objectSpread({},farm3Config),{},{tokenAmount:tokenAmount.toJSON(),// quoteTokenAmount: quoteTokenAmount,\nlpTotalInQuoteToken:lpTotalInQuoteToken.toJSON(),tokenPriceVsQuote:tokenPriceVsQuote.toJSON(),poolWeight:poolWeight.toNumber(),multiplier:\"\".concat(allocPoint.div(100).toString(),\"X\"),depositFeeBP:info.depositFeeBP,senzuPerBlock:new BigNumber(senzuPerBlock).toNumber()}));case 24:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}()));case 2:data=_context2.sent;return _context2.abrupt(\"return\",data);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function fetchFarms3(){return _ref.apply(this,arguments);};}();export default fetchFarms3;","map":{"version":3,"sources":["D:/task159/frontend/src/state/farms3/fetchFarms3.ts"],"names":["BigNumber","erc20","masterchef3ABI","multicall","getMasterChef3Address","farms3Config","QuoteToken","CHAIN_ID","process","env","REACT_APP_CHAIN_ID","fetchFarms3","Promise","all","map","farm3Config","lpAdress","lpAddresses","calls","address","tokenAddresses","name","params","quoteTokenAdresses","isTokenOnly","tokenBalanceLP","quoteTokenBlanceLP","lpTokenBalanceMC","lpTotalSupply","tokenDecimals","quoteTokenDecimals","tokenAmount","div","pow","tokenSymbol","BUSD","quoteTokenSymbol","tokenPriceVsQuote","lpTotalInQuoteToken","times","lpTokenRatio","quoteTokenAmount","comparedTo","pid","info","totalAllocPoint","senzuPerBlock","allocPoint","_hex","poolWeight","toJSON","toNumber","multiplier","toString","depositFeeBP","data"],"mappings":"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","sourcesContent":["import BigNumber from 'bignumber.js'\nimport erc20 from 'config/abi/erc20.json'\nimport masterchef3ABI from 'config/abi/masterchef3.json'\nimport multicall from 'utils/multicall'\nimport { getMasterChef3Address } from 'utils/addressHelpers'\nimport farms3Config from 'config/constants/farms3'\nimport { QuoteToken } from '../../config/constants/types'\n\nconst CHAIN_ID = process.env.REACT_APP_CHAIN_ID\n\nconst fetchFarms3 = async () => {\n  const data = await Promise.all(\n    farms3Config.map(async (farm3Config) => {\n      const lpAdress = farm3Config.lpAddresses[CHAIN_ID]\n      const calls = [\n        // Balance of token in the LP contract\n        {\n          address: farm3Config.tokenAddresses[CHAIN_ID],\n          name: 'balanceOf',\n          params: [lpAdress],\n        },\n        // Balance of quote token on LP contract\n        {\n          address: farm3Config.quoteTokenAdresses[CHAIN_ID],\n          name: 'balanceOf',\n          params: [lpAdress],\n        },\n        // Balance of LP tokens in the master chef contract\n        {\n          address: farm3Config.isTokenOnly ? farm3Config.tokenAddresses[CHAIN_ID] : lpAdress,\n          name: 'balanceOf',\n          params: [getMasterChef3Address()],\n        },\n        // Total supply of LP tokens\n        {\n          address: lpAdress,\n          name: 'totalSupply',\n        },\n        // Token decimals\n        {\n          address: farm3Config.tokenAddresses[CHAIN_ID],\n          name: 'decimals',\n        },\n        // Quote token decimals\n        {\n          address: farm3Config.quoteTokenAdresses[CHAIN_ID],\n          name: 'decimals',\n        },\n      ]\n\n      const [\n        tokenBalanceLP,\n        quoteTokenBlanceLP,\n        lpTokenBalanceMC,\n        lpTotalSupply,\n        tokenDecimals,\n        quoteTokenDecimals\n      ] = await multicall(erc20, calls)\n\n      let tokenAmount;\n      let lpTotalInQuoteToken;\n      let tokenPriceVsQuote;\n      if(farm3Config.isTokenOnly){\n        tokenAmount = new BigNumber(lpTokenBalanceMC).div(new BigNumber(10).pow(tokenDecimals));\n        if(farm3Config.tokenSymbol === QuoteToken.BUSD && farm3Config.quoteTokenSymbol === QuoteToken.BUSD){\n          tokenPriceVsQuote = new BigNumber(1);\n        }else{\n          tokenPriceVsQuote = new BigNumber(quoteTokenBlanceLP).div(new BigNumber(tokenBalanceLP));\n        }\n        lpTotalInQuoteToken = tokenAmount.times(tokenPriceVsQuote);\n      }else{\n        // Ratio in % a LP tokens that are in staking, vs the total number in circulation\n        const lpTokenRatio = new BigNumber(lpTokenBalanceMC).div(new BigNumber(lpTotalSupply))\n\n        // Total value in staking in quote token value\n        lpTotalInQuoteToken = new BigNumber(quoteTokenBlanceLP)\n          .div(new BigNumber(10).pow(18))\n          .times(new BigNumber(2))\n          .times(lpTokenRatio)\n\n        // Amount of token in the LP that are considered staking (i.e amount of token * lp ratio)\n        tokenAmount = new BigNumber(tokenBalanceLP).div(new BigNumber(10).pow(tokenDecimals)).times(lpTokenRatio)\n        const quoteTokenAmount = new BigNumber(quoteTokenBlanceLP)\n          .div(new BigNumber(10).pow(quoteTokenDecimals))\n          .times(lpTokenRatio)\n\n        if(tokenAmount.comparedTo(0) > 0){\n          tokenPriceVsQuote = quoteTokenAmount.div(tokenAmount);\n        }else{\n          tokenPriceVsQuote = new BigNumber(quoteTokenBlanceLP).div(new BigNumber(tokenBalanceLP));\n        }\n      }\n\n      const [info, totalAllocPoint, senzuPerBlock] = await multicall(masterchef3ABI, [\n        {\n          address: getMasterChef3Address(),\n          name: 'poolInfo',\n          params: [farm3Config.pid],\n        },\n        {\n          address: getMasterChef3Address(),\n          name: 'totalAllocPoint',\n        },\n        {\n          address: getMasterChef3Address(),\n          name: 'senzuPerBlock',\n        },\n      ])\n\n      const allocPoint = new BigNumber(info.allocPoint._hex)\n      const poolWeight = allocPoint.div(new BigNumber(totalAllocPoint))\n\n      return {\n        ...farm3Config,\n        tokenAmount: tokenAmount.toJSON(),\n        // quoteTokenAmount: quoteTokenAmount,\n        lpTotalInQuoteToken: lpTotalInQuoteToken.toJSON(),\n        tokenPriceVsQuote: tokenPriceVsQuote.toJSON(),\n        poolWeight: poolWeight.toNumber(),\n        multiplier: `${allocPoint.div(100).toString()}X`,\n        depositFeeBP: info.depositFeeBP,\n        senzuPerBlock: new BigNumber(senzuPerBlock).toNumber(),\n      }\n      console.log(\n        farm3Config,\n        tokenAmount,\n        lpTotalInQuoteToken,\n        tokenPriceVsQuote,\n        poolWeight,\n        senzuPerBlock,\n      )\n    }),\n  )\n  return data\n}\n\nexport default fetchFarms3\n"]},"metadata":{},"sourceType":"module"}