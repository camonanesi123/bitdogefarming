{"ast":null,"code":"import _taggedTemplateLiteral from\"D:/task159/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import _regeneratorRuntime from\"D:/task159/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/task159/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{jsx as _jsx}from\"react/jsx-runtime\";import _slicedToArray from\"D:/task159/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";function _templateObject5(){var data=_taggedTemplateLiteral([\"\\n  display: flex;\\n  font-size: 14px;\\n  padding: 3px 0;\\n\"]);_templateObject5=function _templateObject5(){return data;};return data;}function _templateObject4(){var data=_taggedTemplateLiteral([\"\\n  height: \",\"px;\\n  width: \",\"px;\\n\"]);_templateObject4=function _templateObject4(){return data;};return data;}function _templateObject3(){var data=_taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  flex-direction: row;\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: center;\\n  margin: 16px 0;\\n  width: 100%;\\n  box-sizing: border-box;\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  background-image: url('/images/pool-finished-sash.svg');\\n  background-position: top right;\\n  background-repeat: not-repeat;\\n  height: 135px;\\n  position: absolute;\\n  right: -24px;\\n  top: -24px;\\n  width: 135px;\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import BigNumber from'bignumber.js';import React,{useCallback,useState}from'react';import styled from'styled-components';import{Button,IconButton,useModal,AddIcon,Image}from'@pancakeswap-libs/uikit';import{useWallet}from'@binance-chain/bsc-use-wallet';import UnlockButton from'components/UnlockButton';import Label from'components/Label';import{useERC20}from'hooks/useContract';import{useSousApprove}from'hooks/useApprove';import useI18n from'hooks/useI18n';import{useSmartStake}from'hooks/useStake';import{useSmartUnstake}from'hooks/useUnstake';import useBlock from'hooks/useBlock';import{getBalanceNumber}from'utils/formatBalance';import{useSmartChefHarvest}from'hooks/useHarvest';import Balance from'components/Balance';import{QuoteToken,PoolCategory}from'config/constants/types';import DepositModal from'./DepositModal';import WithdrawModal from'./WithdrawModal';import CardTitle from'./CardTitle';import Card from'./Card';import OldSyrupTitle from'./OldSyrupTitle';import HarvestButton from'./HarvestButton';import CardFooter from'./CardFooter';var CHAIN_ID=process.env.REACT_APP_CHAIN_ID;var PoolCard=function PoolCard(_ref){var pool=_ref.pool;var sousId=pool.sousId,image=pool.image,tokenName=pool.tokenName,stakingTokenName=pool.stakingTokenName,stakingTokenAddress=pool.stakingTokenAddress,projectLink=pool.projectLink,harvest=pool.harvest,apy=pool.apy,tokenDecimals=pool.tokenDecimals,poolCategory=pool.poolCategory,totalStaked=pool.totalStaked,startBlock=pool.startBlock,endBlock=pool.endBlock,isFinished=pool.isFinished,userData=pool.userData,stakingLimit=pool.stakingLimit,burnFee=pool.burnFee;// Pools using native BNB behave differently than pools using a token\nvar isBnbPool=poolCategory===PoolCategory.BINANCE;var TranslateString=useI18n();var stakingTokenContract=useERC20(stakingTokenAddress[CHAIN_ID]);var _useWallet=useWallet(),account=_useWallet.account;var block=useBlock();var _useSousApprove=useSousApprove(stakingTokenContract,sousId),onApprove=_useSousApprove.onApprove;var _useSmartStake=useSmartStake(sousId,isBnbPool),onStake=_useSmartStake.onStake;var _useSmartUnstake=useSmartUnstake(sousId),onUnstake=_useSmartUnstake.onUnstake;var _useSmartChefHarvest=useSmartChefHarvest(sousId,isBnbPool),onReward=_useSmartChefHarvest.onReward;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),requestedApproval=_useState2[0],setRequestedApproval=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),pendingTx=_useState4[0],setPendingTx=_useState4[1];var allowance=new BigNumber((userData===null||userData===void 0?void 0:userData.allowance)||0);var stakingTokenBalance=new BigNumber((userData===null||userData===void 0?void 0:userData.stakingTokenBalance)||0);var stakedBalance=new BigNumber((userData===null||userData===void 0?void 0:userData.stakedBalance)||0);var earnings=new BigNumber((userData===null||userData===void 0?void 0:userData.pendingReward)||0);var blocksUntilStart=Math.max(startBlock-block,0);var blocksRemaining=Math.max(endBlock-block,0);var isOldSyrup=stakingTokenName===QuoteToken.SYRUP;var accountHasStakedBalance=(stakedBalance===null||stakedBalance===void 0?void 0:stakedBalance.toNumber())>0;var needsApproval=!accountHasStakedBalance&&!allowance.toNumber()&&!isBnbPool;var isCardActive=isFinished&&accountHasStakedBalance;var convertedLimit=new BigNumber(stakingLimit).multipliedBy(new BigNumber(10).pow(tokenDecimals));var _useModal=useModal(/*#__PURE__*/_jsx(DepositModal,{max:stakingLimit&&stakingTokenBalance.isGreaterThan(convertedLimit)?convertedLimit:stakingTokenBalance,onConfirm:onStake,tokenName:stakingLimit?\"\".concat(stakingTokenName,\" (\").concat(stakingLimit,\" max)\"):stakingTokenName,depositFeeBP:burnFee*10})),_useModal2=_slicedToArray(_useModal,1),onPresentDeposit=_useModal2[0];var _useModal3=useModal(/*#__PURE__*/_jsx(WithdrawModal,{max:stakedBalance,onConfirm:onUnstake,tokenName:stakingTokenName})),_useModal4=_slicedToArray(_useModal3,1),onPresentWithdraw=_useModal4[0];var handleApprove=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var txHash;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setRequestedApproval(true);_context.next=4;return onApprove();case 4:txHash=_context.sent;// user rejected tx or didn't go thru\nif(!txHash){setRequestedApproval(false);}_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.error(_context.t0);case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);})),[onApprove,setRequestedApproval]);return/*#__PURE__*/_jsxs(Card,{isActive:isCardActive,isFinished:isFinished,children:[isFinished&&/*#__PURE__*/_jsx(PoolFinishedSash,{}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'24px'},children:[/*#__PURE__*/_jsxs(CardTitle,{isFinished:isFinished,children:[isOldSyrup&&'[OLD]',\" \",tokenName,\" \",TranslateString(348,'Pool')]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'8px',display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(\"div\",{style:{flex:1},children:/*#__PURE__*/_jsx(Image,{src:\"/images/bnbpool/BNB.svg\",width:64,height:64,alt:tokenName})}),account&&harvest&&!isOldSyrup&&/*#__PURE__*/_jsx(HarvestButton,{disabled:!earnings.toNumber()||pendingTx,text:pendingTx?'Collecting':'Harvest',onClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setPendingTx(true);_context2.next=3;return onReward();case 3:setPendingTx(false);case 4:case\"end\":return _context2.stop();}}},_callee2);}))})]}),!isOldSyrup?/*#__PURE__*/_jsx(BalanceAndCompound,{children:/*#__PURE__*/_jsx(Balance,{value:getBalanceNumber(earnings,tokenDecimals),decimals:tokenName==='BTCB'?5:3,isDisabled:isFinished})}):/*#__PURE__*/_jsx(OldSyrupTitle,{hasBalance:accountHasStakedBalance}),/*#__PURE__*/_jsx(Label,{isFinished:isFinished,text:TranslateString(330,\"\".concat(tokenName,\" earned\"))}),/*#__PURE__*/_jsxs(StyledCardActions,{children:[!account&&/*#__PURE__*/_jsx(UnlockButton,{}),account&&(needsApproval&&!isOldSyrup?/*#__PURE__*/_jsx(\"div\",{style:{flex:1},children:/*#__PURE__*/_jsx(Button,{disabled:isFinished||requestedApproval,onClick:handleApprove,width:\"100%\",children:\"Approve \".concat(stakingTokenName)})}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{disabled:stakedBalance.eq(new BigNumber(0))||pendingTx,onClick:isOldSyrup?/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setPendingTx(true);_context3.next=3;return onUnstake('0');case 3:setPendingTx(false);case 4:case\"end\":return _context3.stop();}}},_callee3);})):onPresentWithdraw,children:\"Unstake \".concat(stakingTokenName)}),/*#__PURE__*/_jsx(StyledActionSpacer,{}),!isOldSyrup&&/*#__PURE__*/_jsx(IconButton,{disabled:isFinished,onClick:onPresentDeposit,children:/*#__PURE__*/_jsx(AddIcon,{color:\"background\"})})]}))]}),/*#__PURE__*/_jsxs(StyledDetails,{children:[/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[TranslateString(736,'APR'),\":\"]}),isFinished||isOldSyrup||!apy||(apy===null||apy===void 0?void 0:apy.isNaN())||!(apy===null||apy===void 0?void 0:apy.isFinite())?'-':/*#__PURE__*/_jsx(Balance,{fontSize:\"14px\",isDisabled:isFinished,value:apy===null||apy===void 0?void 0:apy.toNumber(),decimals:2,unit:\"%\"})]}),/*#__PURE__*/_jsxs(StyledDetails,{children:[/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsxs(\"span\",{role:\"img\",\"aria-label\":stakingTokenName,children:[\"\\uD83D\\uDC32\",' ']}),TranslateString(384,'Your Stake'),\":\"]}),/*#__PURE__*/_jsx(Balance,{fontSize:\"14px\",isDisabled:isFinished,value:getBalanceNumber(stakedBalance)})]}),burnFee>0?/*#__PURE__*/_jsxs(StyledDetails,{children:[/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsxs(\"span\",{role:\"img\",\"aria-label\":stakingTokenName,children:[\"\\uD83D\\uDD25\",' ']}),TranslateString(10005,'Burn fee'),\":\"]}),/*#__PURE__*/_jsx(Balance,{fontSize:\"14px\",isDisabled:isFinished,value:burnFee/10,decimals:1,unit:\"%\"})]}):'']}),/*#__PURE__*/_jsx(CardFooter,{projectLink:projectLink,totalStaked:totalStaked,blocksRemaining:blocksRemaining,isFinished:isFinished,blocksUntilStart:blocksUntilStart,poolCategory:poolCategory,unit:\"blocks\"})]});};var PoolFinishedSash=styled.div(_templateObject());var StyledCardActions=styled.div(_templateObject2());var BalanceAndCompound=styled.div(_templateObject3());var StyledActionSpacer=styled.div(_templateObject4(),function(props){return props.theme.spacing[4];},function(props){return props.theme.spacing[4];});var StyledDetails=styled.div(_templateObject5());export default PoolCard;","map":{"version":3,"sources":["D:/task159/frontend/src/views/Pools/components/PoolCard.tsx"],"names":["BigNumber","React","useCallback","useState","styled","Button","IconButton","useModal","AddIcon","Image","useWallet","UnlockButton","Label","useERC20","useSousApprove","useI18n","useSmartStake","useSmartUnstake","useBlock","getBalanceNumber","useSmartChefHarvest","Balance","QuoteToken","PoolCategory","DepositModal","WithdrawModal","CardTitle","Card","OldSyrupTitle","HarvestButton","CardFooter","CHAIN_ID","process","env","REACT_APP_CHAIN_ID","PoolCard","pool","sousId","image","tokenName","stakingTokenName","stakingTokenAddress","projectLink","harvest","apy","tokenDecimals","poolCategory","totalStaked","startBlock","endBlock","isFinished","userData","stakingLimit","burnFee","isBnbPool","BINANCE","TranslateString","stakingTokenContract","account","block","onApprove","onStake","onUnstake","onReward","requestedApproval","setRequestedApproval","pendingTx","setPendingTx","allowance","stakingTokenBalance","stakedBalance","earnings","pendingReward","blocksUntilStart","Math","max","blocksRemaining","isOldSyrup","SYRUP","accountHasStakedBalance","toNumber","needsApproval","isCardActive","convertedLimit","multipliedBy","pow","isGreaterThan","onPresentDeposit","onPresentWithdraw","handleApprove","txHash","console","error","padding","marginBottom","display","alignItems","flex","eq","isNaN","isFinite","PoolFinishedSash","div","StyledCardActions","BalanceAndCompound","StyledActionSpacer","props","theme","spacing","StyledDetails"],"mappings":"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","sourcesContent":["import BigNumber from 'bignumber.js'\r\nimport React, { useCallback, useState } from 'react'\r\nimport styled from 'styled-components'\r\nimport { Button, IconButton, useModal, AddIcon, Image } from '@pancakeswap-libs/uikit'\r\nimport { useWallet } from '@binance-chain/bsc-use-wallet'\r\nimport UnlockButton from 'components/UnlockButton'\r\nimport Label from 'components/Label'\r\nimport { useERC20 } from 'hooks/useContract'\r\nimport { useSousApprove } from 'hooks/useApprove'\r\nimport useI18n from 'hooks/useI18n'\r\nimport { useSmartStake } from 'hooks/useStake'\r\nimport { useSmartUnstake } from 'hooks/useUnstake'\r\nimport useBlock from 'hooks/useBlock'\r\nimport { getBalanceNumber } from 'utils/formatBalance'\r\nimport { useSmartChefHarvest } from 'hooks/useHarvest'\r\nimport Balance from 'components/Balance'\r\nimport { QuoteToken, PoolCategory } from 'config/constants/types'\r\nimport { Pool } from 'state/types'\r\nimport DepositModal from './DepositModal'\r\nimport WithdrawModal from './WithdrawModal'\r\nimport CardTitle from './CardTitle'\r\nimport Card from './Card'\r\nimport OldSyrupTitle from './OldSyrupTitle'\r\nimport HarvestButton from './HarvestButton'\r\nimport CardFooter from './CardFooter'\r\n\r\nconst CHAIN_ID = process.env.REACT_APP_CHAIN_ID\r\n\r\ninterface PoolWithApy extends Pool {\r\n  apy: BigNumber\r\n}\r\n\r\ninterface HarvestProps {\r\n  pool: PoolWithApy\r\n}\r\n\r\nconst PoolCard: React.FC<HarvestProps> = ({ pool }) => {\r\n  const {\r\n    sousId,\r\n    image,\r\n    tokenName,\r\n    stakingTokenName,\r\n    stakingTokenAddress,\r\n    projectLink,\r\n    harvest,\r\n    apy,\r\n    tokenDecimals,\r\n    poolCategory,\r\n    totalStaked,\r\n    startBlock,\r\n    endBlock,\r\n    isFinished,\r\n    userData,\r\n    stakingLimit,\r\n    burnFee,\r\n  } = pool\r\n  // Pools using native BNB behave differently than pools using a token\r\n  const isBnbPool = poolCategory === PoolCategory.BINANCE\r\n  const TranslateString = useI18n()\r\n  const stakingTokenContract = useERC20(stakingTokenAddress[CHAIN_ID])\r\n  const { account } = useWallet()\r\n  const block = useBlock()\r\n  const { onApprove } = useSousApprove(stakingTokenContract, sousId)\r\n  const { onStake } = useSmartStake(sousId, isBnbPool)\r\n  const { onUnstake } = useSmartUnstake(sousId)\r\n  const { onReward } = useSmartChefHarvest(sousId, isBnbPool)\r\n\r\n  const [requestedApproval, setRequestedApproval] = useState(false)\r\n  const [pendingTx, setPendingTx] = useState(false)\r\n\r\n  const allowance = new BigNumber(userData?.allowance || 0)\r\n  const stakingTokenBalance = new BigNumber(userData?.stakingTokenBalance || 0)\r\n  const stakedBalance = new BigNumber(userData?.stakedBalance || 0)\r\n  const earnings = new BigNumber(userData?.pendingReward || 0)\r\n\r\n  const blocksUntilStart = Math.max(startBlock - block, 0)\r\n  const blocksRemaining = Math.max(endBlock - block, 0)\r\n  const isOldSyrup = stakingTokenName === QuoteToken.SYRUP\r\n  const accountHasStakedBalance = stakedBalance?.toNumber() > 0\r\n  const needsApproval = !accountHasStakedBalance && !allowance.toNumber() && !isBnbPool\r\n  const isCardActive = isFinished && accountHasStakedBalance\r\n\r\n  const convertedLimit = new BigNumber(stakingLimit).multipliedBy(new BigNumber(10).pow(tokenDecimals))\r\n  const [onPresentDeposit] = useModal(\r\n    <DepositModal\r\n      max={stakingLimit && stakingTokenBalance.isGreaterThan(convertedLimit) ? convertedLimit : stakingTokenBalance}\r\n      onConfirm={onStake}\r\n      tokenName={stakingLimit ? `${stakingTokenName} (${stakingLimit} max)` : stakingTokenName}\r\n      depositFeeBP={burnFee * 10}\r\n    />,\r\n  )\r\n\r\n  const [onPresentWithdraw] = useModal(\r\n    <WithdrawModal max={stakedBalance} onConfirm={onUnstake} tokenName={stakingTokenName} />,\r\n  )\r\n\r\n  const handleApprove = useCallback(async () => {\r\n    try {\r\n      setRequestedApproval(true)\r\n      const txHash = await onApprove()\r\n      // user rejected tx or didn't go thru\r\n      if (!txHash) {\r\n        setRequestedApproval(false)\r\n      }\r\n    } catch (e) {\r\n      console.error(e)\r\n    }\r\n  }, [onApprove, setRequestedApproval])\r\n\r\n  return (\r\n    <Card isActive={isCardActive} isFinished={isFinished}>\r\n      {isFinished && <PoolFinishedSash />}\r\n      <div style={{ padding: '24px' }}>\r\n        <CardTitle isFinished={isFinished}>\r\n          {isOldSyrup && '[OLD]'} {tokenName} {TranslateString(348, 'Pool')}\r\n        </CardTitle>\r\n        <div style={{ marginBottom: '8px', display: 'flex', alignItems: 'center' }}>\r\n          <div style={{ flex: 1 }}>\r\n            <Image src=\"/images/bnbpool/BNB.svg\" width={64} height={64} alt={tokenName} />\r\n          </div>\r\n          {account && harvest && !isOldSyrup && (\r\n            <HarvestButton\r\n              disabled={!earnings.toNumber() || pendingTx}\r\n              text={pendingTx ? 'Collecting' : 'Harvest'}\r\n              onClick={async () => {\r\n                setPendingTx(true)\r\n                await onReward()\r\n                setPendingTx(false)\r\n              }}\r\n            />\r\n          )}\r\n        </div>\r\n        {!isOldSyrup ? (\r\n          <BalanceAndCompound>\r\n            <Balance\r\n              value={getBalanceNumber(earnings, tokenDecimals)}\r\n              decimals={tokenName === 'BTCB' ? 5 : 3}\r\n              isDisabled={isFinished}\r\n            />\r\n          </BalanceAndCompound>\r\n        ) : (\r\n          <OldSyrupTitle hasBalance={accountHasStakedBalance} />\r\n        )}\r\n        <Label isFinished={isFinished} text={TranslateString(330, `${tokenName} earned`)} />\r\n        <StyledCardActions>\r\n          {!account && <UnlockButton />}\r\n          {account &&\r\n            (needsApproval && !isOldSyrup ? (\r\n              <div style={{ flex: 1 }}>\r\n                <Button disabled={isFinished || requestedApproval} onClick={handleApprove} width=\"100%\">\r\n                  {`Approve ${stakingTokenName}`}\r\n                </Button>\r\n              </div>\r\n            ) : (\r\n              <>\r\n                <Button\r\n                  disabled={stakedBalance.eq(new BigNumber(0)) || pendingTx}\r\n                  onClick={\r\n                    isOldSyrup\r\n                      ? async () => {\r\n                          setPendingTx(true)\r\n                          await onUnstake('0')\r\n                          setPendingTx(false)\r\n                        }\r\n                      : onPresentWithdraw\r\n                  }\r\n                >\r\n                  {`Unstake ${stakingTokenName}`}\r\n                </Button>\r\n                <StyledActionSpacer />\r\n                {!isOldSyrup && (\r\n                  <IconButton disabled={isFinished} onClick={onPresentDeposit}>\r\n                    <AddIcon color=\"background\" />\r\n                  </IconButton>\r\n                )}\r\n              </>\r\n            ))}\r\n        </StyledCardActions>\r\n        <StyledDetails>\r\n          <div style={{ flex: 1 }}>{TranslateString(736, 'APR')}:</div>\r\n          {isFinished || isOldSyrup || !apy || apy?.isNaN() || !apy?.isFinite() ? (\r\n            '-'\r\n          ) : (\r\n            <Balance fontSize=\"14px\" isDisabled={isFinished} value={apy?.toNumber()} decimals={2} unit=\"%\" />\r\n          )}\r\n        </StyledDetails>\r\n        <StyledDetails>\r\n          <div style={{ flex: 1 }}>\r\n            <span role=\"img\" aria-label={stakingTokenName}>\r\n              üê≤{' '}\r\n            </span>\r\n            {TranslateString(384, 'Your Stake')}:\r\n          </div>\r\n          <Balance fontSize=\"14px\" isDisabled={isFinished} value={getBalanceNumber(stakedBalance)} />\r\n        </StyledDetails>\r\n        {burnFee > 0 ? (\r\n          <StyledDetails>\r\n            <div style={{ flex: 1 }}>\r\n              <span role=\"img\" aria-label={stakingTokenName}>\r\n                üî•{' '}\r\n              </span>\r\n              {TranslateString(10005, 'Burn fee')}:\r\n            </div>\r\n            <Balance fontSize=\"14px\" isDisabled={isFinished} value={burnFee / 10} decimals={1} unit=\"%\" />\r\n          </StyledDetails>\r\n        ) : (\r\n          ''\r\n        )}\r\n      </div>\r\n      <CardFooter\r\n        projectLink={projectLink}\r\n        totalStaked={totalStaked}\r\n        blocksRemaining={blocksRemaining}\r\n        isFinished={isFinished}\r\n        blocksUntilStart={blocksUntilStart}\r\n        poolCategory={poolCategory}\r\n        unit=\"blocks\"\r\n      />\r\n    </Card>\r\n  )\r\n}\r\n\r\nconst PoolFinishedSash = styled.div`\r\n  background-image: url('/images/pool-finished-sash.svg');\r\n  background-position: top right;\r\n  background-repeat: not-repeat;\r\n  height: 135px;\r\n  position: absolute;\r\n  right: -24px;\r\n  top: -24px;\r\n  width: 135px;\r\n`\r\n\r\nconst StyledCardActions = styled.div`\r\n  display: flex;\r\n  justify-content: center;\r\n  margin: 16px 0;\r\n  width: 100%;\r\n  box-sizing: border-box;\r\n`\r\n\r\nconst BalanceAndCompound = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  flex-direction: row;\r\n`\r\n\r\nconst StyledActionSpacer = styled.div`\r\n  height: ${(props) => props.theme.spacing[4]}px;\r\n  width: ${(props) => props.theme.spacing[4]}px;\r\n`\r\n\r\nconst StyledDetails = styled.div`\r\n  display: flex;\r\n  font-size: 14px;\r\n  padding: 3px 0;\r\n`\r\n\r\nexport default PoolCard\r\n"]},"metadata":{},"sourceType":"module"}