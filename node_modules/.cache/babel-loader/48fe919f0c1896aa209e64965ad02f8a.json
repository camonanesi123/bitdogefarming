{"ast":null,"code":"import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import _regeneratorRuntime from\"D:/task159/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/task159/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{jsx as _jsx}from\"react/jsx-runtime\";import _slicedToArray from\"D:/task159/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"D:/task159/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject3(){var data=_taggedTemplateLiteral([\"\\n  align-items: center;\\n  height: 24px;\\n  justify-content: center;\\n  margin-top: -12px;\\n  position: absolute;\\n  right: 16px;\\n  top: 50%;\\n  width: 24px;\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n  padding-right: 40px;\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  position: relative;\\n  max-width: 240px;\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useState}from'react';import styled from'styled-components';import BigNumber from'bignumber.js';import{Card,CardBody,Heading,Text,Input as UIKitInput,Button,AutoRenewIcon,CheckmarkIcon,Flex,WarningIcon,useModal,Skeleton,Checkbox}from'@pancakeswap-libs/uikit';import{useToast}from'state/hooks';import useWeb3 from'hooks/useWeb3';import useI18n from'hooks/useI18n';import useHasCakeBalance from'hooks/useHasCakeBalance';import{useWallet}from'@binance-chain/bsc-use-wallet';import ConfirmProfileCreationModal from'../components/ConfirmProfileCreationModal';import useProfileCreation from'./contexts/hook';import{USERNAME_MIN_LENGTH,USERNAME_MAX_LENGTH,REGISTER_COST}from'./config';var ExistingUserState;(function(ExistingUserState){ExistingUserState[\"IDLE\"]=\"idle\";ExistingUserState[\"CREATED\"]=\"created\";ExistingUserState[\"NEW\"]=\"new\";})(ExistingUserState||(ExistingUserState={}));var profileApiUrl=process.env.REACT_APP_API_PROFILE;var minimumCakeToRegister=new BigNumber(REGISTER_COST).multipliedBy(new BigNumber(10).pow(18));var InputWrap=styled.div(_templateObject());var Input=styled(UIKitInput)(_templateObject2());var Indicator=styled(Flex)(_templateObject3());var UserName=function UserName(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isAcknowledged=_useState2[0],setIsAcknowledged=_useState2[1];var _useProfileCreation=useProfileCreation(),teamId=_useProfileCreation.teamId,selectedNft=_useProfileCreation.selectedNft,userName=_useProfileCreation.userName,actions=_useProfileCreation.actions,minimumCakeRequired=_useProfileCreation.minimumCakeRequired,allowance=_useProfileCreation.allowance;var TranslateString=useI18n();var _useWallet=useWallet(),account=_useWallet.account;// const { library } = useWeb3React()\nvar _useToast=useToast(),toastError=_useToast.toastError;var web3=useWeb3();var _useState3=useState(ExistingUserState.NEW),_useState4=_slicedToArray(_useState3,2),existingUserState=_useState4[0],setExistingUserState=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isValid=_useState6[0],setIsValid=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isLoading=_useState8[0],setIsLoading=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),message=_useState10[0],setMessage=_useState10[1];var hasMinimumCakeRequired=useHasCakeBalance(minimumCakeToRegister);var _useModal=useModal(/*#__PURE__*/_jsx(ConfirmProfileCreationModal,{userName:userName,selectedNft:selectedNft,account:account,teamId:teamId,minimumCakeRequired:minimumCakeRequired,allowance:allowance}),false),_useModal2=_slicedToArray(_useModal,1),onPresentConfirmProfileCreation=_useModal2[0];var isUserCreated=existingUserState===ExistingUserState.CREATED;var handleChange=function handleChange(event){var value=event.target.value;actions.setUserName(value);if(value.length>=3&&value.length<=15){setIsValid(true);}else{setIsValid(false);}};var handleConfirm=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var signature,response,_data$error,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setIsLoading(true);_context.next=4;return web3.eth.personal.sign(userName,account,null);case 4:signature=_context.sent;_context.next=7;return fetch(\"\".concat(profileApiUrl,\"/api/users/register\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({address:account,username:userName,signature:signature})});case 7:response=_context.sent;console.log(response.ok);if(response.ok){_context.next=13;break;}setExistingUserState(ExistingUserState.CREATED);_context.next=17;break;case 13:_context.next=15;return response.json();case 15:data=_context.sent;toastError(data===null||data===void 0?void 0:(_data$error=data.error)===null||_data$error===void 0?void 0:_data$error.message);case 17:_context.next=22;break;case 19:_context.prev=19;_context.t0=_context[\"catch\"](0);toastError((_context.t0===null||_context.t0===void 0?void 0:_context.t0.message)?_context.t0.message:JSON.stringify(_context.t0));case 22:_context.prev=22;setIsLoading(false);return _context.finish(22);case 25:case\"end\":return _context.stop();}}},_callee,null,[[0,19,22,25]]);}));return function handleConfirm(){return _ref.apply(this,arguments);};}();var handleAcknowledge=function handleAcknowledge(){return setIsAcknowledged(!isAcknowledged);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{fontSize:\"20px\",color:\"textSubtle\",bold:true,children:TranslateString(999,\"Step \".concat(4))}),/*#__PURE__*/_jsx(Heading,{as:\"h3\",size:\"xl\",mb:\"24px\",children:TranslateString(1110,'Set Your Name')}),/*#__PURE__*/_jsx(Text,{as:\"p\",mb:\"24px\",children:TranslateString(999,'This name will be shown in team leaderboards and search results as long as your profile is active.')}),/*#__PURE__*/_jsx(Card,{mb:\"24px\",children:/*#__PURE__*/_jsxs(CardBody,{children:[/*#__PURE__*/_jsx(Heading,{as:\"h4\",size:\"lg\",mb:\"8px\",children:TranslateString(1110,'Set Your Name')}),/*#__PURE__*/_jsx(Text,{as:\"p\",color:\"textSubtle\",mb:\"24px\",children:TranslateString(840,'Your name must be at least 3 and at most 15 standard letters and numbers long. You canâ€™t change this once you click Confirm.')}),existingUserState===ExistingUserState.IDLE?/*#__PURE__*/_jsx(Skeleton,{height:\"40px\",width:\"240px\"}):/*#__PURE__*/_jsxs(InputWrap,{children:[/*#__PURE__*/_jsx(Input,{onChange:handleChange,isWarning:userName&&!isValid,isSuccess:userName&&isValid,minLength:USERNAME_MIN_LENGTH,maxLength:USERNAME_MAX_LENGTH,disabled:isUserCreated,placeholder:TranslateString(1094,'Enter your name...'),value:userName}),/*#__PURE__*/_jsxs(Indicator,{children:[isLoading&&/*#__PURE__*/_jsx(AutoRenewIcon,{spin:true}),!isLoading&&isValid&&userName&&/*#__PURE__*/_jsx(CheckmarkIcon,{color:\"success\"}),!isLoading&&!isValid&&userName&&/*#__PURE__*/_jsx(WarningIcon,{color:\"failure\"})]})]}),/*#__PURE__*/_jsx(Text,{color:\"textSubtle\",fontSize:\"14px\",py:\"4px\",mb:\"16px\",style:{minHeight:'30px'},children:message}),/*#__PURE__*/_jsx(Text,{as:\"p\",color:\"failure\",mb:\"8px\",children:TranslateString(1100,\"Only reuse a name from other social media if you're OK with people viewing your wallet. You can't change your name once you click Confirm.\")}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"checkbox\",style:{display:'block',cursor:'pointer',marginBottom:'24px'},children:/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",children:[/*#__PURE__*/_jsx(\"div\",{style:{flex:'none'},children:/*#__PURE__*/_jsx(Checkbox,{id:\"checkbox\",scale:\"sm\",checked:isAcknowledged,onChange:handleAcknowledge})}),/*#__PURE__*/_jsx(Text,{ml:\"8px\",children:TranslateString(1096,'I understand that people can view my wallet if they know my username')})]})}),/*#__PURE__*/_jsx(Button,{onClick:handleConfirm,disabled:!isValid||isUserCreated||isLoading||!isAcknowledged,children:TranslateString(464,'Confirm')})]})}),/*#__PURE__*/_jsx(Button,{onClick:onPresentConfirmProfileCreation,disabled:!isValid||!isUserCreated,children:TranslateString(842,'Complete Profile')}),!hasMinimumCakeRequired&&/*#__PURE__*/_jsx(Text,{color:\"failure\",mt:\"16px\",children:TranslateString(1098,\"A minimum of \".concat(REGISTER_COST,\" DBALL is required\"),{num:REGISTER_COST})})]});};export default UserName;","map":{"version":3,"sources":["D:/task159/frontend/src/views/Profile/ProfileCreation/UserName.tsx"],"names":["React","useState","styled","BigNumber","Card","CardBody","Heading","Text","Input","UIKitInput","Button","AutoRenewIcon","CheckmarkIcon","Flex","WarningIcon","useModal","Skeleton","Checkbox","useToast","useWeb3","useI18n","useHasCakeBalance","useWallet","ConfirmProfileCreationModal","useProfileCreation","USERNAME_MIN_LENGTH","USERNAME_MAX_LENGTH","REGISTER_COST","ExistingUserState","profileApiUrl","process","env","REACT_APP_API_PROFILE","minimumCakeToRegister","multipliedBy","pow","InputWrap","div","Indicator","UserName","isAcknowledged","setIsAcknowledged","teamId","selectedNft","userName","actions","minimumCakeRequired","allowance","TranslateString","account","toastError","web3","NEW","existingUserState","setExistingUserState","isValid","setIsValid","isLoading","setIsLoading","message","setMessage","hasMinimumCakeRequired","onPresentConfirmProfileCreation","isUserCreated","CREATED","handleChange","event","value","target","setUserName","length","handleConfirm","eth","personal","sign","signature","fetch","method","headers","body","JSON","stringify","address","username","response","console","log","ok","json","data","error","handleAcknowledge","IDLE","minHeight","display","cursor","marginBottom","flex","num"],"mappings":"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","sourcesContent":["import React, { ChangeEvent, useEffect, useState } from 'react'\nimport styled from 'styled-components'\nimport BigNumber from 'bignumber.js'\nimport {\n  Card,\n  CardBody,\n  Heading,\n  Text,\n  Input as UIKitInput,\n  Button,\n  AutoRenewIcon,\n  CheckmarkIcon,\n  Flex,\n  WarningIcon,\n  useModal,\n  Skeleton,\n  Checkbox,\n} from '@pancakeswap-libs/uikit'\nimport { parseISO, formatDistance } from 'date-fns'\nimport { useWeb3React } from '@web3-react/core'\nimport { useToast } from 'state/hooks'\nimport useWeb3 from 'hooks/useWeb3'\nimport useI18n from 'hooks/useI18n'\nimport useHasCakeBalance from 'hooks/useHasCakeBalance'\nimport debounce from 'lodash/debounce'\nimport { useWallet } from '@binance-chain/bsc-use-wallet'\nimport ConfirmProfileCreationModal from '../components/ConfirmProfileCreationModal'\nimport useProfileCreation from './contexts/hook'\nimport { USERNAME_MIN_LENGTH, USERNAME_MAX_LENGTH, REGISTER_COST } from './config'\n\nenum ExistingUserState {\n  IDLE = 'idle', // initial state\n  CREATED = 'created', // username has already been created\n  NEW = 'new', // username has not been created\n}\n\nconst profileApiUrl = process.env.REACT_APP_API_PROFILE\nconst minimumCakeToRegister = new BigNumber(REGISTER_COST).multipliedBy(new BigNumber(10).pow(18))\n\nconst InputWrap = styled.div`\n  position: relative;\n  max-width: 240px;\n`\n\nconst Input = styled(UIKitInput)`\n  padding-right: 40px;\n`\n\nconst Indicator = styled(Flex)`\n  align-items: center;\n  height: 24px;\n  justify-content: center;\n  margin-top: -12px;\n  position: absolute;\n  right: 16px;\n  top: 50%;\n  width: 24px;\n`\n\nconst UserName: React.FC = () => {\n  const [isAcknowledged, setIsAcknowledged] = useState(false)\n  const { teamId, selectedNft, userName, actions, minimumCakeRequired, allowance } = useProfileCreation()\n  const TranslateString = useI18n()\n  const { account } = useWallet()\n  // const { library } = useWeb3React()\n  const { toastError } = useToast()\n  const web3 = useWeb3()\n  const [existingUserState, setExistingUserState] = useState<ExistingUserState>(ExistingUserState.NEW)\n  const [isValid, setIsValid] = useState(false)\n  const [isLoading, setIsLoading] = useState(false)\n  const [message, setMessage] = useState('')\n  const hasMinimumCakeRequired = useHasCakeBalance(minimumCakeToRegister)\n  const [onPresentConfirmProfileCreation] = useModal(\n    <ConfirmProfileCreationModal\n      userName={userName}\n      selectedNft={selectedNft}\n      account={account}\n      teamId={teamId}\n      minimumCakeRequired={minimumCakeRequired}\n      allowance={allowance}\n    />,\n    false,\n  )\n  const isUserCreated = existingUserState === ExistingUserState.CREATED\n\n  const handleChange = (event: ChangeEvent<HTMLInputElement>) => {\n    const { value } = event.target\n    actions.setUserName(value)\n\n    if(value.length >= 3 && value.length <= 15)\n    {\n      setIsValid(true)\n    }\n    else\n    {\n      setIsValid(false)\n    }\n  }\n\n  const handleConfirm = async () => {\n    try {\n      setIsLoading(true)\n      const signature = await web3.eth.personal.sign(userName, account, null) // Last param is the password, and is null to request a signature in the wallet\n\n      const response = await fetch(`${profileApiUrl}/api/users/register`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          address: account,\n          username: userName,\n          signature,\n        }),\n      })\n\n      console.log(response.ok)\n\n      if (!response.ok) {\n        setExistingUserState(ExistingUserState.CREATED)\n      } else {\n        const data = await response.json()\n        toastError(data?.error?.message)\n      }\n    } catch (error) {\n      toastError(error?.message ? error.message : JSON.stringify(error))\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const handleAcknowledge = () => setIsAcknowledged(!isAcknowledged)\n\n  return (\n    <>\n      <Text fontSize=\"20px\" color=\"textSubtle\" bold>\n        {TranslateString(999, `Step ${4}`)}\n      </Text>\n      <Heading as=\"h3\" size=\"xl\" mb=\"24px\">\n        {TranslateString(1110, 'Set Your Name')}\n      </Heading>\n      <Text as=\"p\" mb=\"24px\">\n        {TranslateString(\n          999,\n          'This name will be shown in team leaderboards and search results as long as your profile is active.',\n        )}\n      </Text>\n      <Card mb=\"24px\">\n        <CardBody>\n          <Heading as=\"h4\" size=\"lg\" mb=\"8px\">\n            {TranslateString(1110, 'Set Your Name')}\n          </Heading>\n          <Text as=\"p\" color=\"textSubtle\" mb=\"24px\">\n            {TranslateString(\n              840,\n              'Your name must be at least 3 and at most 15 standard letters and numbers long. You canâ€™t change this once you click Confirm.',\n            )}\n          </Text>\n          {existingUserState === ExistingUserState.IDLE ? (\n            <Skeleton height=\"40px\" width=\"240px\" />\n          ) : (\n            <InputWrap>\n              <Input\n                onChange={handleChange}\n                isWarning={userName && !isValid}\n                isSuccess={userName && isValid}\n                minLength={USERNAME_MIN_LENGTH}\n                maxLength={USERNAME_MAX_LENGTH}\n                disabled={isUserCreated}\n                placeholder={TranslateString(1094, 'Enter your name...')}\n                value={userName}\n              />\n              <Indicator>\n                {isLoading && <AutoRenewIcon spin />}\n                {!isLoading && isValid && userName && <CheckmarkIcon color=\"success\" />}\n                {!isLoading && !isValid && userName && <WarningIcon color=\"failure\" />}\n              </Indicator>\n            </InputWrap>\n          )}\n          <Text color=\"textSubtle\" fontSize=\"14px\" py=\"4px\" mb=\"16px\" style={{ minHeight: '30px' }}>\n            {message}\n          </Text>\n          <Text as=\"p\" color=\"failure\" mb=\"8px\">\n            {TranslateString(\n              1100,\n              \"Only reuse a name from other social media if you're OK with people viewing your wallet. You can't change your name once you click Confirm.\",\n            )}\n          </Text>\n          <label htmlFor=\"checkbox\" style={{ display: 'block', cursor: 'pointer', marginBottom: '24px' }}>\n            <Flex alignItems=\"center\">\n              <div style={{ flex: 'none' }}>\n                <Checkbox id=\"checkbox\" scale=\"sm\" checked={isAcknowledged} onChange={handleAcknowledge} />\n              </div>\n              <Text ml=\"8px\">\n                {TranslateString(1096, 'I understand that people can view my wallet if they know my username')}\n              </Text>\n            </Flex>\n          </label>\n          <Button onClick={handleConfirm} disabled={!isValid || isUserCreated || isLoading || !isAcknowledged}>\n            {TranslateString(464, 'Confirm')}\n          </Button>\n        </CardBody>\n      </Card>\n      <Button onClick={onPresentConfirmProfileCreation} disabled={!isValid || !isUserCreated}>\n        {TranslateString(842, 'Complete Profile')}\n      </Button>\n      {!hasMinimumCakeRequired && (\n        <Text color=\"failure\" mt=\"16px\">\n          {TranslateString(1098, `A minimum of ${REGISTER_COST} DBALL is required`, { num: REGISTER_COST })}\n        </Text>\n      )}\n    </>\n  )\n}\n\nexport default UserName\n"]},"metadata":{},"sourceType":"module"}